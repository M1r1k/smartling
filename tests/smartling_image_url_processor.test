<?php

require_once(dirname(__FILE__) . '/../alters/smartling_content_image_url_processor.inc');


/**
 * @file
 * Tests for smartling
 */
class SmartlingContentImageUrlProcessorTest extends DrupalUnitTestCase {
  private $context;
  private $entity;

  public static function getInfo() {
    return array(
      'name' => 'Content - Smartling Content Urls/image Processor',
      'description' => 'Checks custom demo behaviour of the processor',
      'group' => 'Smartling UnitTests'
    );
  }

  protected function setUp() {
    parent::setUp();

    // Enable Smartling modules
    $this->context = array('external' => TRUE);
    $this->entity = new stdClass();
  }

  public function testShouldConvertLinks() {
    $item   = array('href="http://site.com"', 'href', 'http://site.com');
    $result = array('href="http://site.com"', 'href', 'http://en.site.com/');
    $proc = new SmartlingContentImageUrlProcessor();

    $proc->process($item, $this->context, 'en', 'field_body', $this->entity);

    $this->assertEqual($result, $item);
  }

  public function testShouldConvertLinksWithWWW() {
    $item   = array('href="http://www.site.com"', 'href', 'http://www.site.com');
    $result = array('href="http://www.site.com"', 'href', 'http://en.site.com/');
    $proc = new SmartlingContentImageUrlProcessor();

    $proc->process($item, $this->context, 'en', 'field_body', $this->entity);

    $this->assertEqual($result, $item);
  }

  public function testShouldNotConvertImage() {
    $item   = array('src="http://site.com/logo.png"', 'src', 'http://site.com/logo.png');
    $result = array('src="http://site.com/logo.png"', 'src', 'http://site.com/logo.png');
    $proc = new SmartlingContentImageUrlProcessor();

    $proc->process($item, $this->context, 'en', 'field_body', $this->entity);
    $this->assertEqual($result, $item);
  }

  public function testShouldNotConvertAnotherDomain() {
    $item   = array('href="http://site1.com"', 'href', 'http://site1.com');
    $result = array('href="http://site1.com"', 'href', 'http://site1.com');
    $proc = new SmartlingContentImageUrlProcessor();

    $proc->process($item, $this->context, 'en', 'field_body', $this->entity);

    $this->assertEqual($result, $item);
  }
}