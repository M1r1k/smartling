<?php

/**
 * @file
 * Code for the Smartling reports feature.
 */
include_once 'smartling_reports.features.inc';

/**
 * Implements hook_menu().
 */
function smartling_reports_menu() {
  $items = array();

  $items['admin/content/smartling'] = array(
    'title' => 'Submissions',
    'description' => 'Submissions',
    'weight' => 101,
    'access arguments' => array('administer smartling'),
    'type' => MENU_LOCAL_TASK,
  );
  $items['admin/content/smartling-content'] = array(
    'title' => 'Smartling Bulk Submit',
    'description' => 'Smartling Bulk Submit',
    'weight' => 100,
    'access arguments' => array('administer smartling'),
    'type' => MENU_LOCAL_TASK,
  );

  return $items;
}

/**
 * Implements hook_menu_alter().
 */
function smartling_reports_menu_alter(&$items) {
  if (!empty($items['admin/content/smartling/report-completed'])) {
    $items['admin/content/smartling']['page callback'] = $items['admin/content/smartling/report-completed']['page callback'];
    $items['admin/content/smartling']['page arguments'] = $items['admin/content/smartling/report-completed']['page arguments'];
    $items['admin/content/smartling']['load arguments'] = $items['admin/content/smartling/report-completed']['load arguments'];
    $items['admin/content/smartling/report-completed']['type'] = MENU_DEFAULT_LOCAL_TASK;
  }

  if (!empty($items['admin/content/smartling-content/node'])) {
    $items['admin/content/smartling-content']['page callback'] = $items['admin/content/smartling-content/node']['page callback'];
    $items['admin/content/smartling-content']['page arguments'] = $items['admin/content/smartling-content/node']['page arguments'];
    $items['admin/content/smartling-content']['load arguments'] = $items['admin/content/smartling-content/node']['load arguments'];
    $items['admin/content/smartling-content/node']['type'] = MENU_DEFAULT_LOCAL_TASK;
  }
}

/**
 * Implements hook_views_data_alter().
 */
function smartling_reports_views_query_alter(&$view, &$query) {
  // Exclude und language
  if ($view->name == 'smartling_bulk_submit_taxonomy_terms') {
    $query->where[] = array(
      'conditions' => array(array(
          'field' => 'taxonomy_term_data.language',
          'value' => array('und'),
          'operator' => '<>',
        )),
      'args' => array(),
      'type' => 'AND',
    );
  }
}
