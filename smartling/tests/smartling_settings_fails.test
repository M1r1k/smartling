<?php

/**
 * @file
 * Tests for smartling
 */
class SmartlingSettingsAccountInfoSaveFailsTest extends SmartlingWebTestCase {

  public static function getInfo() {
    return array(
      'name' => 'Smartling settings - Account info. Save incorrect settings',
      'description' => 'Test failed flow of saving Smartling settings - Account info',
      'group' => 'Smartling'
    );
  }

  public function testIncorrectSmartlingAccountInfoSettingsApiUrl() {
    // Set correct account settings
    $this->smartlingSetCorrectSettings();

    $edit = array(
      "api_url" => 'https://capi.smartling.com/incorrect',
    );
    $this->drupalPost('admin/config/regional/smartling', $edit, t('Save'), array(), array(), 'smartling-admin-account-info-settings-form');
    $this->assertText(t('Not Found'));
    $this->assertText(t('Please input correct Smartling settings.'));
  }

  public function testIncorrectSmartlingAccountInfoSettingsProjectId() {
    // Set correct account settings
    $this->smartlingSetCorrectSettings();

    $edit = array(
      "project_id" => $this->randomName(9),
    );
    $this->drupalPost('admin/config/regional/smartling', $edit, t('Save'), array(), array(), 'smartling-admin-account-info-settings-form');
    $this->assertText(t('Unauthorized'));
    $this->assertText(t('Please input correct Smartling settings.'));
  }

  public function testIncorrectSmartlingAccountInfoSettingsKey() {
    // Set correct account settings
    $this->smartlingSetCorrectSettings();

    $edit = array(
      "smartling_key" => $this->randomName(36),
    );
    $this->drupalPost('admin/config/regional/smartling', $edit, t('Save'), array(), array(), 'smartling-admin-account-info-settings-form');
    $this->assertText(t('Unauthorized'));
    $this->assertText(t('Please input correct Smartling settings.'));
  }

  public function testIncorrectSmartlingAccountInfoSettingsTargetLocales() {
    // Set correct account settings
    $this->smartlingSetCorrectSettings();

    $edit = array(
      "target_locales[ru]" => FALSE,
      "target_locales_text_key_ru" => '',
    );
    $this->drupalPost('admin/config/regional/smartling', $edit, t('Save'), array(), array(), 'smartling-admin-account-info-settings-form');
    $this->assertText(t('At least one locale must be selected'));
  }

}
